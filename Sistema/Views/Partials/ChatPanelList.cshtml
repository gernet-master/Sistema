@*
    Descrição: Lista os usuários do chat
    Data: 01/01/2020 - v.1.0
*@

@model Sistema.Models.PartialsView_ChatPanelList

@using Functions;

@{
    int online = 0;
    int offline = 0;
    string txt_online = "";
    string txt_offline = "";

    // Loop nos usuários
    foreach (var u in Model.usuarios)
    {
        // Verifica se está online e com status diferente de invisível
        if ((Utils.Session(u.idsession)) && (u.flstatuschat != 3))
        {

            txt_online += "<div class='kt-notification-v2'>";
            txt_online += "    <a href='#' class='kt-notification-v2__item'>";
            txt_online += "        <div class='kt-notification-v2__item-icon'>";

            // Status do usuário
            switch (u.flstatuschat)
            {
                case 1: txt_online += "<span class='kt-badge kt-badge--success kt-badge--dot kt-badge--xl'></span>"; break;
                case 4: txt_online += "<span class='kt-badge kt-badge--warning kt-badge--dot kt-badge--xl'></span>"; break;
            }

            txt_online += "            <img class='chat-img' src='" + Utils.Avatar(u.txfoto) + "'>";
            txt_online += "        </div>";
            txt_online += "        <div class='kt-notification-v2__itek-wrapper'>";
            txt_online += "            <div class='kt-notification-v2__item-title'>" + u.txnome;

            // Quantidade de mensagens não lidas
            if (u.qtnaolidas > 0)
            {
                txt_online += "<span class='kt-badge kt-badge--success'>" + u.qtnaolidas + "</span>";
            }

            txt_online += "</div>";
            txt_online += "<div class='kt-notification-v2__item-desc'>";

            // Verifica se foi enviado ou recebido alguma mensagem
            if (u.mensagem.dtmensagem.value != null)
            {
                // Enviado
                if (u.mensagem.idremetente.value == Convert.ToInt32(Session["usuario"]))
                {
                    // Verifica se o destinatário recebeu
                    if (u.mensagem.dtrecebido.value == null)
                    {
                        txt_online += "<i class='fa fa-check'></i>&nbsp;";
                    }

                    // Recebeu, verifica se foi lido
                    else
                    {
                        // Verifica se a mensagem possui confirmação de leitura
                        if (u.mensagem.flprivacidade.value == 1)
                        {
                            txt_online += "<i class='fa fa-check " + (u.mensagem.dtlido.value != null ? "btn-font-success" : "") + "'></i>";
                            txt_online += "<i class='fa fa-check " + (u.mensagem.dtlido.value != null ? "btn-font-success" : "") + "'></i>&nbsp;";
                        }
                        else
                        {
                            txt_online += "<i class='fa fa-check'></i>";
                            txt_online += "<i class='fa fa-check'></i>&nbsp;";
                        }
                    }

                    txt_online += u.mensagem.txmensagem.value;
                }

                // Recebido
                else
                {
                    txt_online += u.mensagem.txmensagem.value;
                }
            }

            txt_online += "</div>";
            txt_online += "        </div>";
            txt_online += "    </a>";
            txt_online += "</div>";
            online++;
        }
        else
        {
            txt_offline += "<div class='kt-notification-v2'>";
            txt_offline += "    <a href='#' class='kt-notification-v2__item'>";
            txt_offline += "        <div class='kt-notification-v2__item-icon'>";
            txt_offline += "            <span class='kt-badge kt-badge--danger kt-badge--dot kt-badge--xl'></span>";
            txt_offline += "            <img class='chat-img' src='" + Utils.Avatar(u.txfoto) + "'>";
            txt_offline += "        </div>";
            txt_offline += "        <div class='kt-notification-v2__itek-wrapper'>";
            txt_offline += "            <div class='kt-notification-v2__item-title'>" + u.txnome;

            // Quantidade de mensagens não lidas
            if (u.qtnaolidas > 0)
            {
                txt_offline += "<span class='kt-badge kt-badge--success'>" + u.qtnaolidas + "</span>";
            }

            txt_offline += "</div>";
            txt_offline += "<div class='kt-notification-v2__item-desc'>";

            // Verifica se foi enviado ou recebido alguma mensagem
            if (u.mensagem.dtmensagem.value != null)
            {
                // Enviado
                if (u.mensagem.idremetente.value == Convert.ToInt32(Session["usuario"]))
                {

                    // Verifica se o destinatário recebeu
                    if (u.mensagem.dtrecebido.value == null)
                    {
                        txt_offline += "<i class='fa fa-check'></i>&nbsp;";
                    }

                    // Recebeu, verifica se foi lido
                    else
                    {
                        // Verifica se a mensagem possui confirmação de leitura
                        if (u.mensagem.flprivacidade.value == 1)
                        {
                            txt_offline += "<i class='fa fa-check " + (u.mensagem.dtlido.value != null ? "btn-font-success" : "") + "'></i>";
                            txt_offline += "<i class='fa fa-check " + (u.mensagem.dtlido.value != null ? "btn-font-success" : "") + "'></i>&nbsp;";
                        }
                        else
                        {
                            txt_offline += "<i class='fa fa-check'></i>";
                            txt_offline += "<i class='fa fa-check'></i>&nbsp;";
                        }

                    }

                    txt_offline += u.mensagem.txmensagem.value;
                    txt_offline += "<button type='button' class='btn btn-label-brand btn-lg btn-upper' id='kt_app_chat_launch_btn' data-toggle='modal' data-target='#kt_chat_modal'>Send Message</button>"
                }

                // Recebido
                else
                {
                    txt_offline += u.mensagem.txmensagem.value;
                }
            }

            txt_offline += "</div>";
            txt_offline += "        </div>";
            txt_offline += "    </a>";
            txt_offline += "</div>";
            offline++;
        }

    }
}

<!-- Online -->
<div class="kt-notification-v2 kt-notification-item-padding-x kt-align-center kt-padding-8 bg-light-blue pointer" id="chat-button-online">
    @Language.XmlLang(108, 1).Text (@online)
</div>
<div id="chat-div-online" class="@(Model.flonline == 0 ? "kt-hidden" : "")">@Html.Raw(txt_online)</div>

<!-- Offline -->
<div class="kt-notification-v2 kt-notification-item-padding-x kt-align-center kt-padding-8 bg-light-blue kt-margin-t-15 pointer" id="chat-button-offline">
    @Language.XmlLang(109, 1).Text (@offline)
</div>
<div id="chat-div-offline" class="@(Model.floffline == 0 ? "kt-hidden" : "")">@Html.Raw(txt_offline)</div>

<!--Begin:: Chat-->
<div class="modal fade- modal-sticky-bottom-right" id="kt_chat_modal" role="dialog" data-backdrop="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="kt-chat">
                <div class="kt-portlet kt-portlet--last">
                    <div class="kt-portlet__head">
                        <div class="kt-chat__head ">
                            <div class="kt-chat__left">
                                <div class="kt-chat__label">
                                    <a href="#" class="kt-chat__title">Jason Muller</a>
                                    <span class="kt-chat__status">
                                        <span class="kt-badge kt-badge--dot kt-badge--success"></span> Active
                                    </span>
                                </div>
                            </div>
                            <div class="kt-chat__right">
                                <div class="dropdown dropdown-inline">
                                    <button type="button" class="btn btn-clean btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="flaticon-more-1"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-fit dropdown-menu-right dropdown-menu-md">
                                        <!--begin::Nav-->
                                        <ul class="kt-nav">
                                            <li class="kt-nav__head">
                                                Messaging
                                                <i class="flaticon2-information" data-toggle="kt-tooltip" data-placement="right" title="Click to learn more..."></i>
                                            </li>
                                            <li class="kt-nav__separator"></li>
                                            <li class="kt-nav__item">
                                                <a href="#" class="kt-nav__link">
                                                    <i class="kt-nav__link-icon flaticon2-group"></i>
                                                    <span class="kt-nav__link-text">New Group</span>
                                                </a>
                                            </li>
                                            <li class="kt-nav__item">
                                                <a href="#" class="kt-nav__link">
                                                    <i class="kt-nav__link-icon flaticon2-open-text-book"></i>
                                                    <span class="kt-nav__link-text">Contacts</span>
                                                    <span class="kt-nav__link-badge">
                                                        <span class="kt-badge kt-badge--brand  kt-badge--rounded-">5</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="kt-nav__item">
                                                <a href="#" class="kt-nav__link">
                                                    <i class="kt-nav__link-icon flaticon2-bell-2"></i>
                                                    <span class="kt-nav__link-text">Calls</span>
                                                </a>
                                            </li>
                                            <li class="kt-nav__item">
                                                <a href="#" class="kt-nav__link">
                                                    <i class="kt-nav__link-icon flaticon2-dashboard"></i>
                                                    <span class="kt-nav__link-text">Settings</span>
                                                </a>
                                            </li>
                                            <li class="kt-nav__item">
                                                <a href="#" class="kt-nav__link">
                                                    <i class="kt-nav__link-icon flaticon2-protected"></i>
                                                    <span class="kt-nav__link-text">Help</span>
                                                </a>
                                            </li>
                                            <li class="kt-nav__separator"></li>
                                            <li class="kt-nav__foot">
                                                <a class="btn btn-label-brand btn-bold btn-sm" href="#">Upgrade plan</a>
                                                <a class="btn btn-clean btn-bold btn-sm" href="#" data-toggle="kt-tooltip" data-placement="right" title="Click to learn more...">Learn more</a>
                                            </li>
                                        </ul>
                                        <!--end::Nav-->
                                    </div>
                                </div>
                                <button type="button" class="btn btn-clean btn-sm btn-icon" data-dismiss="modal">
                                    <i class="flaticon2-cross"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="kt-portlet__body">
                        <div class="kt-scroll kt-scroll--pull" data-height="410" data-mobile-height="300">
                            <div class="kt-chat__messages kt-chat__messages--solid">
                                <div class="kt-chat__message kt-chat__message--success">
                                    <div class="kt-chat__user">
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/100_12.jpg" alt="image">
                                        </span>
                                        <a href="#" class="kt-chat__username">Jason Muller</span></a>
                                        <span class="kt-chat__datetime">2 Hours</span>
                                    </div>
                                    <div class="kt-chat__text">
                                        How likely are you to recommend our company<br> to your friends and family?
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--right kt-chat__message--brand">
                                    <div class="kt-chat__user">
                                        <span class="kt-chat__datetime">30 Seconds</span>
                                        <a href="#" class="kt-chat__username">You</span></a>
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/300_21.jpg" alt="image">
                                        </span>
                                    </div>
                                    <div class="kt-chat__text">
                                        Hey there, we’re just writing to let you know that you’ve<br> been subscribed to a repository on GitHub.
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--success">
                                    <div class="kt-chat__user">
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/100_12.jpg" alt="image">
                                        </span>
                                        <a href="#" class="kt-chat__username">Jason Muller</span></a>
                                        <span class="kt-chat__datetime">30 Seconds</span>
                                    </div>
                                    <div class="kt-chat__text">
                                        Ok, Understood!
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--right kt-chat__message--brand">
                                    <div class="kt-chat__user">
                                        <span class="kt-chat__datetime">Just Now</span>
                                        <a href="#" class="kt-chat__username">You</span></a>
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/300_21.jpg" alt="image">
                                        </span>
                                    </div>
                                    <div class="kt-chat__text">
                                        You’ll receive notifications for all issues, pull requests!
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--success">
                                    <div class="kt-chat__user">
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/100_12.jpg" alt="image">
                                        </span>
                                        <a href="#" class="kt-chat__username">Jason Muller</span></a>
                                        <span class="kt-chat__datetime">2 Hours</span>
                                    </div>
                                    <div class="kt-chat__text">
                                        You were automatically <b class="kt-font-brand">subscribed</b> <br>because you’ve been given access to the repository
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--right kt-chat__message--brand">
                                    <div class="kt-chat__user">
                                        <span class="kt-chat__datetime">30 Seconds</span>
                                        <a href="#" class="kt-chat__username">You</span></a>
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/300_21.jpg" alt="image">
                                        </span>
                                    </div>
                                    <div class="kt-chat__text">
                                        You can unwatch this repository immediately <br>by clicking here: <a href="#" class="kt-font-bold kt-link"></a>
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--success">
                                    <div class="kt-chat__user">
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/100_12.jpg" alt="image">
                                        </span>
                                        <a href="#" class="kt-chat__username">Jason Muller</span></a>
                                        <span class="kt-chat__datetime">30 Seconds</span>
                                    </div>
                                    <div class="kt-chat__text">
                                        Discover what students who viewed Learn <br>Figma - UI/UX Design Essential Training also viewed
                                    </div>
                                </div>
                                <div class="kt-chat__message kt-chat__message--right kt-chat__message--brand">
                                    <div class="kt-chat__user">
                                        <span class="kt-chat__datetime">Just Now</span>
                                        <a href="#" class="kt-chat__username">You</span></a>
                                        <span class="kt-media kt-media--circle kt-media--sm">
                                            <img src="assets/media/users/300_21.jpg" alt="image">
                                        </span>
                                    </div>
                                    <div class="kt-chat__text">
                                        Most purchased Business courses during this sale!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="kt-portlet__foot">
                        <div class="kt-chat__input">
                            <div class="kt-chat__editor">
                                <textarea placeholder="Type here..." style="height: 50px"></textarea>
                            </div>
                            <div class="kt-chat__toolbar">
                                <div class="kt_chat__tools">
                                    <a href="#"><i class="flaticon2-link"></i></a>
                                    <a href="#"><i class="flaticon2-photograph"></i></a>
                                    <a href="#"><i class="flaticon2-photo-camera"></i></a>
                                </div>
                                <div class="kt_chat__actions">
                                    <button type="button" class="btn btn-brand btn-md  btn-font-sm btn-upper btn-bold kt-chat__reply">reply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--ENd:: Chat-->